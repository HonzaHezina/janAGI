{
  "name": "WF_48 Jackie Web",
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "id": "3c684534-d0e7-4cb4-b05c-a788b9aaa32e",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -1200,
        -80
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "jsCode": "// Použijeme $input.first(), což vezme data, která do tohoto uzlu přišla\n// Pokud jsou data prázdná, vytvoříme prázdný objekt, aby to nepadlo\nconst trigger = $input.first() ? $input.first().json : {};\n\n// Bezpečně získáme text\nconst text = String(trigger.text || '').trim();\nconst safeQuery = text.replace(/\\s+/g, ' ').trim();\n\n// DŮLEŽITÉ: Na produkci chceme použít web_browser tool (procházení stránek), ne web_search (API klíče).\n// Prompt proto výslovně zakazuje web_search a vede na browser-based search (DuckDuckGo/Google přes web_browser).\n// Také zakážeme \"výmluvy\" typu curl/scraping/sandbox/no-web-access ve výstupu.\n\nlet prompt;\nif (safeQuery && safeQuery.length > 0) {\n  prompt = `You are Jackie (web handler).\n\nHARD RULES\n- NEVER use or mention: curl, scraping tool, sandbox limitations, \"nemám přístup k webu\".\n\nTOOLS\n- You MUST use the web_browser tool (browser mode).\n- Do NOT use web_search.\n\nTASK\nFind current information for: ${safeQuery}.\nIf you need to search, use web_browser to open a public search results page (e.g. DuckDuckGo/Google) and extract results from the page.\n\nOUTPUT\nReturn the top 5 results. For each: title, absolute URL, and 1-sentence Czech summary.\nReply in Czech.`;\n} else {\n  prompt = `You are Jackie (web handler).\n\nHARD RULES\n- NEVER use or mention: curl, scraping tool, sandbox limitations, \"nemám přístup k webu\".\n\nTOOLS\n- You MUST use the web_browser tool (browser mode).\n- Do NOT use web_search.\n\nTASK\nFind 5 recent relevant results. If you need to search, use web_browser to open a public search results page (e.g. DuckDuckGo/Google).\n\nOUTPUT\nReturn the top 5 results: title, absolute URL, and 1-sentence Czech summary.\nReply in Czech.`;\n}\n\nreturn [{\n  json: {\n    chat_id: trigger.chat_id || null,\n    conversation_id: trigger.conversation_id || null,\n    run_id: trigger.run_id || null,\n    prompt,\n    model: trigger.model || 'openclaw:main'\n  }\n}];"
      },
      "id": "1170041c-b8ea-4d40-b5cb-bf779095aa39",
      "name": "Build Web Prompt",
      "type": "n8n-nodes-base.code",
      "position": [
        -288,
        -32
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{$env.OPENCLAW_BASE_URL || 'http://openclaw:18789'}}/v1/responses",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "={{ $json.model }}"
            },
            {
              "name": "user",
              "value": "={{ 'telegram:' + ($json.chat_id || 'unknown') }}"
            },
            {
              "name": "input",
              "value": "={{ $json.prompt }}"
            }
          ]
        },
        "options": {}
      },
      "id": "43eae826-0ad8-405e-af19-a732508cca40",
      "name": "OpenClaw Request",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        48,
        -32
      ],
      "typeVersion": 4.3,
      "credentials": {
        "httpBearerAuth": {
          "id": "oXGTUfvk6a176dto",
          "name": "Bearer Auth account JH"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const trigger = $('Execute Workflow Trigger').first().json;\nconst content = ($json.output?.[0]?.content || []).map(c => c.text || '').join('\\n');\nconst output = content || JSON.stringify($json);\n\nreturn [{\n  json: {\n    output: output.slice(0, 4000),\n    chat_id: trigger.chat_id,\n    conversation_id: trigger.conversation_id,\n    run_id: trigger.run_id\n  }\n}];\n"
      },
      "id": "693542f2-2403-40e3-8af4-4a03b818103a",
      "name": "Build Output",
      "type": "n8n-nodes-base.code",
      "position": [
        368,
        -64
      ],
      "typeVersion": 2
    }
  ],
  "connections": {
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Build Web Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Web Prompt": {
      "main": [
        [
          {
            "node": "OpenClaw Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenClaw Request": {
      "main": [
        [
          {
            "node": "Build Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "instanceId": "5a7da51956588969891cb8fbd03e12cea4f6c23e6fdb6590eadcd26e5b4a5643"
  },
  "tags": []
}
