{
  "name": "WF_03_Analyst_Draft_and_Telegram_Approval (skeleton)",
  "nodes": [
    {
      "name": "Trigger (new message)",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "analyst",
        "httpMethod": "POST"
      }
    },
    {
      "name": "Retrieve knowledge (pgvector)",
      "type": "n8n-nodes-langchain.vectorStorePGVector",
      "parameters": {
        "operation": "retrieve",
        "filter": "{\"metadata.client_id\":\"={{$json.client_id}}\",\"metadata.project_id\":\"={{$json.project_id}}\",\"metadata.type\":\"expert_knowledge\"}"
      }
    },
    {
      "name": "Retrieve SOP (pgvector)",
      "type": "n8n-nodes-langchain.vectorStorePGVector",
      "parameters": {
        "operation": "retrieve",
        "filter": "{\"metadata.client_id\":\"={{$json.client_id}}\",\"metadata.project_id\":\"={{$json.project_id}}\",\"metadata.type\":\"sop\"}"
      }
    },
    {
      "name": "Retrieve history (pgvector)",
      "type": "n8n-nodes-langchain.vectorStorePGVector",
      "parameters": {
        "operation": "retrieve",
        "filter": "{\"metadata.client_id\":\"={{$json.client_id}}\",\"metadata.project_id\":\"={{$json.project_id}}\",\"metadata.type\":\"history\",\"metadata.conversation_id\":\"={{$json.conversation_id}}\"}"
      }
    },
    {
      "name": "LLM Draft",
      "type": "n8n-nodes-langchain.chat",
      "parameters": {
        "model": "mistral",
        "prompt": "-- TODO: prompt template"
      }
    },
    {
      "name": "Send to Telegram (approval)",
      "type": "n8n-nodes-base.telegram",
      "parameters": {
        "operation": "sendMessage",
        "text": "-- TODO"
      }
    }
  ],
  "connections": {}
}
